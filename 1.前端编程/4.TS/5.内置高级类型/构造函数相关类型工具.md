# 构造函数相关类型工具

## ConstructorParameters<Type>

+ `ConstructorParameters<Type>` 从构造函数类型中获取构造函数参数的元组类型

  ```js
  class User{
    constructor(public id:number, public name: string){}
  }

  type ConstructorParamsType1 = ConstructorParameters<typeof User>; // [id: number, name: string]
  ```

+ 对于ConstructorParameters的实现其实和之前的ReturnType十分类似，只不过现在我们需要构造函数类型去进行处理

  ```js
  type MyConstructorParams<T extends abstract new (...args: any[]) => any> = T extends abstract new (...args: infer R) => any ? R : never;

  type ConstructorParamsType2 = MyConstructorParams<typeof User>;
  ```

## InstanceType<Type>

+ 通过构造函数类型得到实例对象类型

  ```js
  class User{
    constructor(public id:number, public name: string){}
  }

  type U = InstanceType<typeof User>;
  ```

  ```js
  type MyInstanceType<T extends abstract new (...args: any[]) => any> = T extends abstract new (...args: any[]) => infer R ? R : never;

  type InstanceUser = MyInstanceType<typeof User>;
  ```

## Awaited<Type>

+ 可以用来获取Promise中的类型(如await、then方法返回的被Promise包裹的数据的类型)

+ 其中Promise是我们常用的异步类，本身就有Promise类型和PromiseConstructor类型

  ```js
  type T = Awaited<Promise<Person>>; // Person
  ```

+ Awaited在我们处理异步场景的时候非常有用

  + 比如有时候我们从第三方库就仅仅能获取接口，并且这个接口可能还返回的是一个Promise类型，那么我们就可以通过Awaited帮我们获取具体函数返回的Promise类型的泛型，也就是真正的数据类型

  ```js
  // 第三方库的函数
  interface User {
    id: number;
    firstName: string;
    lastName: string;
    age: number;
  }


  async function fetchUser(): Promise<User> {
    const data = await fetch(
      "https://mock.mengxuegu.com/mock/65b1f3d1c4cd67421b34cd0c/mock_ts/user"
    ).then((res) => {
      return res.json();
    });
    return data;
  }
  ```

  ```js
  // 获取类型
  type UserFetch = Awaited<ReturnType<typeof fetchUser>>

  const user: UserFetch = {
    id: 1,
    firstName: "yuan",
    lastName: "jin",
    age: 18,
  }
  ```

+ Awaited可以深层嵌套，如果没有Promise的话，就直接返回类型

  ```js
  type A = Awaited<Promise<string>>; // string

  type B = Awaited<Promise<Promise<number>>>; // number

  type C = Awaited<boolean | Promise<number>>; // number | boolean

  type D = Awaited<number>; // number

  type E = Awaited<null>; // null
  ```
