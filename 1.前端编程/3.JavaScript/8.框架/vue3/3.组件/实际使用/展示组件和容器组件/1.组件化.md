# 如何组件化

## 组件化的原因

+ 将一个页面的业务处理逻辑放在一起，处理和维护起来就会很复杂，不利于后续管理和扩展，这个时候就需要使用组件化来分门别类的管理逻辑
+ 组件化有利于单元测试
+ 组件化对重构更友好
+ 拆分组件可能会带来性能优化

## 组件拆分会带来性能优化

+ 未进行组件拆分，数据更新时，vue 需要对每一个元素进行 diff 比较，如果界面上的元素很多，那就会很耗时

+ 有进行组件拆分，数据更新时，当 vue 发现更新后的组件和更新前的组件是一致时，就无需再对组件内部的元素进行 diff 了，那么实际就减少了很多 diff 过程

+ 原理：

  + 每个组件都有一个 watcher，频繁渲染的重任务，可以拆分成一个子组件，避免让整个父组件都重新渲染，从而提高性能。（vue 是每个组件内进行 diff）

+ 数据更新后 vue 的执行流程

  ```md
  数据更新 => ... 触发_update => patch => patchVnode => updateChidren ...
  ```

  |               |拆成组件              |不拆组件                                 |
  |:-             |:-                    |:-                                       |
  | updateChidren | 不用遍历检测所有子节点 | 需要遍历所有子节点（重复 patchVnode 步骤） |

+ 当 dom 节点足够多的时候，遍历检测节点也就大量的时间消耗
