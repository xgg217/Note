# watch

## 概述

+ 等效于 vue2 的 `$watch`

+ 默认是懒侦听的，即仅在侦听源发生变化时才执行回调函数

+ 除非配置了 `options`

## 语法

+ *第一个参数*是侦听器的**源**。这个来源可以是以下几种

  + 一个函数，返回一个值

  + 一个 ref

  + 一个响应式对象

  + ...或是由以上类型的值组成的数组

+ *第二个参数*是在发生变化时要调用的回调函数。这个回调函数接受三个参数：新值、旧值，以及一个用于注册副作用清理的回调函数。该回调函数会在副作用下一次重新执行前调用，可以用来清除无效的副作用，例如等待中的异步请求

  + 当侦听多个来源时，回调函数接受两个数组，分别对应来源数组中的新值和旧值

+ 第三个可选的参数是一个对象，支持以下这些选项：

  + `immediate：true/false`

    + 默认情况下，watch 对应的回调函数是懒执行的，只有在依赖的数据发生变化时，才会执行回调
    + 但是在某些场景中，我们可能期望立即执行一次，例如请求一些初始化数据，这个时候就可以设置该配置项。第一次调用时旧值是 `undefined`

  + `once：true/false` 侦听器的回调函数只执行一次

  + `deep：true/false`

    + 强制转换为深层次侦听器
    + 什么时候会用到呢？有些时候使用 `watch` 来侦听一个由计算属性或者 `getter` 函数返回的对象的时候，默认就不是深层次的侦听
    + 通过设置 `deep` 可以让这种情况下的对象侦听，也变成深层次的侦听

## 返回值

+ Vue 3.5 还增强了 watch 函数的返回值。现在，watch 返回的对象不仅包含停止监视的 stop 方法，还增加了 pause 和 resume 方法，允许我们更细粒度地控制监视器的行为

  ```js
  const { pause, resume, stop } = watch(source, (newVal, oldVal) => {
    // 监视逻辑
  });

  // 暂停监视
  pause();

  // 恢复监视
  resume();
  ```

## watch 指定深度：更精确的深度监听

+ 在 Vue 3.5 之前，watch 的 deep 选项只能设置为 true 或 false，这在需要监听深层嵌套对象时可能会带来性能问题

+ Vue 3.5 允许我们通过设置 deep 为整数来指定监听的深度，这样我们可以更精确地控制监听的范围

  ```js
  watch(reactiveObject, (newVal, oldVal) => {
    // 监听逻辑
  }, { deep: 2 });
  ```

+ 这种方式可以减少不必要的性能开销，特别是在处理大型或深层嵌套对象时

