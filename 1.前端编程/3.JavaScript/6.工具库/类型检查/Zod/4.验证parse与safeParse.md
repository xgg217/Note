# 验证

## parse 与 safeParse 区别

+ `schema.parse(data)` : 如果验证成功，它会返回经过验证（可能也经过转换）的数据

  + 如果验证失败，它会抛出一个 ZodError 异常

+ `schema.safeParse(data)` : 这个方法不会抛出异常。它总是返回一个包含 success 字段的对象

  + 如果验证成功，返回 `{ success: true, data: validatedData }`
  + 如果验证失败，返回 `{ success: false, error: ZodError }`

## 使用场景的区别

+ 在前端，尤其是在处理用户输入或 API 响应时，safeParse 通常是更推荐的选择，因为它允许你更优雅地处理错误，而不需要 `try...catch` 块

  ```js
  import { z } from 'zod';

  const ageSchema = z.number().positive("年龄必须是正数");

  // 使用 safeParse
  const result1 = ageSchema.safeParse(25);
  if (result1.success) {
    console.log("年龄验证成功:", result1.data); // result1.data 是 25
  } else {
    console.error("年龄验证失败:", result1.error.flatten().fieldErrors);
  }

  const result2 = ageSchema.safeParse(-5);
  if (result2.success) {
    console.log("年龄验证成功:", result2.data);
  } else {
    console.error("年龄验证失败:", result2.error.flatten().fieldErrors);
    // 输出: { _errors: [ '年龄必须是正数' ] } (取决于具体错误和 Zod 版本)
    // 或者更常见的是针对字段的错误，如果ageSchema是对象的一部分
    // 对于原始类型，错误可能在 _errors 或直接在 formErrors
  }

  const result3 = ageSchema.safeParse("not a number");
  if (result3.success) {
    console.log("类型验证成功:", result3.data);
  } else {
    console.error("类型验证失败:", result3.error.flatten().formErrors);
    // 输出: [ 'Expected number, received string' ]
  }
  ```

## .parse

+ 对于任何 Zod 模式，使用 .parse 来验证输入
+ 如果有效，Zod 将返回输入的强类型深度克隆

  ```js
  Player.parse({ username: "billie", xp: 100 });
  // { username: "billie", xp: 100 }
  ```

## 异步 .parseAsync()

+ 异步 API，例如 async、refinements 或 transforms，则需要改用 .parseAsync() 方法

  ```js
  await Player.parseAsync({ username: "billie", xp: 100 });
  ```

## safeParse

+ 要避免 try/catch 阻塞，你可以使用 `.safeParse()` 方法返回包含成功解析数据或 ZodError 的纯文本结果对象
+ 结果类型为 可区分联合，因此你可以方便地处理这两种情况

  ```js
  const result = Player.safeParse({ username: 42, xp: "100" });
  if (!result.success) {
    result.error;   // ZodError instance
  } else {
    result.data;    // { username: string; xp: number }
  }
  ```

## .safeParseAsync()

+ 异步 API，例如 async、refinements 或 transforms，则需要改用 .safeParseAsync() 方法。

  ```js
  await schema.safeParseAsync("hello");
  ```


