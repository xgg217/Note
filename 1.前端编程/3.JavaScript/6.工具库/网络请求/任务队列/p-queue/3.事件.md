# 事件

## active 每个任务被处理的时候 触发

+ 每当队列中每个项目被处理时，这些数据会发出，目的是跟踪进度

  ```js
  import delay from 'delay';
  import PQueue from 'p-queue';

  const queue = new PQueue({concurrency: 2});

  let count = 0;
  queue.on('active', () => {
    console.log(`Working on item #${++count}.  Size: ${queue.size}  Pending: ${queue.pending}`);
  });

  queue.add(() => Promise.resolve());
  queue.add(() => delay(2000));
  queue.add(() => Promise.resolve());
  queue.add(() => Promise.resolve());
  queue.add(() => delay(500));
  ```

## completed 当项目无错误完成时发出

+ completed 当项目无错误完成时发出

  ```js
  import delay from 'delay';
  import PQueue from 'p-queue';

  const queue = new PQueue({concurrency: 2});

  queue.on('completed', result => {
    console.log(result);
  });

  queue.add(() => Promise.resolve('hello, world!'));
  ```

## error

+ error 如果某个项目出现错误，就会发出。退回的承诺依然被拒绝，所以你必须同时处理

  ```js
  import PQueue from 'p-queue';

  const queue = new PQueue({concurrency: 2});

  queue.on('error', error => {
    console.error(error);
  });

  // Handle the promise to prevent unhandled rejection
  queue.add(() => Promise.reject(new Error('error'))).catch(() => {
    // Error already handled by event listener
  });
  ```

## empty 每次队列为空

+ empty 每次队列空了就会发出

## idle 完成所有

+ idle 完成所有 `queue.size === 0 && queue.pending === 0`

  ```js
  const queue = new PQueue();

  queue.on('idle', () => {
    console.log(`Queue is idle.  Size: ${queue.size}  Pending: ${queue.pending}`);
  });
  ```

## pendingZero

+ 每当运行任务数变为零时，会发出;queue.pending === 0

## add 添加任务

## next

+ 每当任务完成且待处理或排队任务数量减少时发出
+ 无论任务是否正常完成或出现错误，都会发出该信号

  ```js
  import delay from 'delay';
  import PQueue from 'p-queue';

  const queue = new PQueue();

  queue.on('add', () => {
    console.log(`Task is added.  Size: ${queue.size}  Pending: ${queue.pending}`);
  });

  queue.on('next', () => {
    console.log(`Task is completed.  Size: ${queue.size}  Pending: ${queue.pending}`);
  });

  const job1 = queue.add(() => delay(2000));
  const job2 = queue.add(() => delay(500));

  await job1;
  await job2;
  //=> 'Task is added.  Size: 0  Pending: 1'
  //=> 'Task is added.  Size: 0  Pending: 2'

  await queue.add(() => delay(600));
  //=> 'Task is completed.  Size: 0  Pending: 1'
  //=> 'Task is completed.  Size: 0  Pending: 0'
  ```

## rateLimit 速率限制

## rateLimitCleared

