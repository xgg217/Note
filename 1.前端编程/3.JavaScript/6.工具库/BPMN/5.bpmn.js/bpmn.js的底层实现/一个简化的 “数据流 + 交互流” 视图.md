# 一个简化的 “数据流 + 交互流” 视图

## 概述

下面是一个简化的步骤流程，帮助你把抽象原理对照到实际操作上：

加载 / 初始化
创建一个 Modeler / Viewer 实例
注册内置模块 + 任何 additionalModules
初始化 diagram-js 的图形画布、事件总线、核心服务等
导入 BPMN XML
用 bpmn-moddle 的 fromXML → 得到 BPMN 对象树
遍历对象树，为每个应可视化的元素创建对应的图形元素（shape / connection），并把语义对象 (businessObject) 关联进去
调用渲染器把它们画到 Canvas 上
用户交互 / 编辑
用户发起某个操作（拖拽、连线、删除、重绘等）
事件触发 → 通过 EventBus 分发
Modeling 模块 / 自定义扩展响应操作，请求进行某种修改
在执行修改之前，使用规则模块 (BpmnRules) 判断是否允许
若合法：Modeling 模块调用内部更新器 (BpmnUpdater 等) 同步更新语义层 + 图形层
操作加入 CommandStack，以支持撤销 / 重做
导出 / 保存
最终语义模型 + 属性修改后，调用 bpmn-moddle 的 toXML 将其序列化为 BPMN 2.0 XML
导出的 XML 可以交互给其他 BPMN 工具或服务使用
扩展 / 插件
在创建 Modeler / Viewer 时注入额外模块，修改 / 拓展默认行为
插件可以监听事件、替代渲染、定义新规则、增加新的工具按钮 / 操作等
