# 示例

## 示例

+ 示例

  ```js
  fetch('http://example.com/movies.json').then(response => {
    if (!response.ok) {
      throw new Error(`HTTP 错误！状态：${response.status}`);
    }

    return response.json();
  }).then(myJson => {
    console.log(myJson);
  });
  ```

## 检测请求是否成功

+ 如果遇到网络故障或服务端的 CORS 配置错误时，fetch() promise 将会 reject，带上一个 TypeError 对象
+ 虽然这个情况经常是遇到了权限问题或类似问题——比如 404 不是一个网络故障
+ 想要精确的判断 fetch() 是否成功，需要包含 promise resolved 的情况，此时再判断 Response.ok 是否为 true

  ```js
  fetch("flowers.jpg")
    .then((response) => {
      if (!response.ok) {
        throw new Error("Network response was not OK");
      }
      return response.blob();
    })
    .then((myBlob) => {
      myImage.src = URL.createObjectURL(myBlob);
    })
    .catch((error) => {
      console.error("There has been a problem with your fetch operation:", error);
    });
  ```

## 上传 JSON 数据

+ POST JSON 数据

  ```js
  const data = { username: "example" };

  fetch("https://example.com/profile", {
    method: "POST", // or 'PUT'
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  })
    .then((response) => response.json())
    .then((data) => {
      console.log("Success:", data);
    })
    .catch((error) => {
      console.error("Error:", error);
    });
  ```

## 上传文件

+ 以通过 HTML `<input type="file" />` 元素，FormData() 和 fetch() 上传文件

  ```js
  const fileField = document.querySelector('input[type="file"]');

  const formData = new FormData();
  formData.append("username", "abc123");
  formData.append("avatar", fileField.files[0]);

  fetch("https://example.com/profile/avatar", {
    method: "PUT",
    body: formData,
  })
    .then((response) => response.json())
    .then((result) => {
      console.log("Success:", result);
    })
    .catch((error) => {
      console.error("Error:", error);
    });
  ```

## 上传多个文件

+ 可以通过 HTML `<input type="file" multiple />` 元素，FormData() 和 fetch() 上传文件。

  ```js
  const formData = new FormData();
  const photos = document.querySelector('input[type="file"][multiple]');

  formData.append("title", "My Vegas Vacation");
  for (let i = 0; i < photos.files.length; i++) {
    formData.append(`photos_${i}`, photos.files[i]);
  }

  fetch("https://example.com/posts", {
    method: "POST",
    body: formData,
  })
    .then((response) => response.json())
    .then((result) => {
      console.log("Success:", result);
    })
    .catch((error) => {
      console.error("Error:", error);
    });
  ```
