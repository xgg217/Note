# 删除数据

## 通过主键删除数据

+ 键即我们创建数据库时申明的keyPath，它是唯一的。

  ```js
  /**
   * 通过主键删除数据
   * @param {object} db 数据库实例
   * @param {string} storeName 仓库名称
   * @param {object} id 主键值
   */
  function deleteDB(db, storeName, id) {
    var request = db
      .transaction([storeName], "readwrite")
      .objectStore(storeName)
      .delete(id);

    request.onsuccess = function () {
      console.log("数据删除成功");
    };

    request.onerror = function () {
      console.log("数据删除失败");
    };
  }
  ```

## 通过索引和游标删除指定数据

+ 有时候我们拿不到主键值，只能只能通过索引值来删除，通过这种方式，我们可以删除一条数据（索引值唯一）或者所有满足条件的数据（索引值不唯一）。

+ 使用了 `IDBKeyRange.only()` API，该API代表只能当两个值相等时，具体API解释可参考MDN官网

  ```js
  /**
   * 通过索引和游标删除指定的数据
   * @param {object} db 数据库实例
   * @param {string} storeName 仓库名称
   * @param {string} indexName 索引名
   * @param {object} indexValue 索引值
   */
  function cursorDelete(db, storeName, indexName, indexValue) {
    var store = db.transaction(storeName, "readwrite").objectStore(storeName);
    var request = store
      .index(indexName) // 索引对象
      .openCursor(IDBKeyRange.only(indexValue)); // 指针对象
    request.onsuccess = function (e) {
      var cursor = e.target.result;
      var deleteRequest;
      if (cursor) {
        deleteRequest = cursor.delete(); // 请求删除当前项
        deleteRequest.onerror = function () {
          console.log("游标删除该记录失败");
        };
        deleteRequest.onsuccess = function () {
          console.log("游标删除该记录成功");
        };
        cursor.continue();
      }
    };
    request.onerror = function (e) {};
  }
  ```

