# 指针查询

## 指针

+ 场景是我们压根儿就不知道某一条数据的主键。例如我们要查询学生姓名为“张三”的学生数据，对于我们来讲，我们知道的信息只有学生姓名“张三

  ```js
  /**
   * 通过指针来查询所有数据
   * @param {IDBDatabase} db 数据库实例
   * @param {string} storeName 表名称
   */
  export function getCursorData(db: IDBDatabase, storeName: string) {
    return new Promise((resolve, reject) => {
      const data: TRow[] = [];

      const transaction = db.transaction([storeName]); // 事务
      const objectStore = transaction.objectStore(storeName); // 仓库对象
      const cursorRequest = objectStore.openCursor(); // 打开指针

      cursorRequest.onerror = event => {
        console.log("事务失败");
        reject(event);
      };

      cursorRequest.onsuccess = event => {
        // console.log("主键查询结果: ", request.result);
        // @ts-ignore
        const cursor = event.target.result;

        if (cursor) {
          data.push(cursor.value);

          // 继续游标
          cursor.continue();
        } else {
          resolve(data);
        }
      };

      cursorRequest.onerror = event => {
        console.log("事务失败");
        reject(event);
      };
    });
  }

  getCursorData(dbVal!, "stu")
    .then(res => {
      console.log(res);
    })
    .catch(err => {
      console.error(err);
    });
  ```
