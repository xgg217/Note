# 打开数据库

## API

+ `window.indexedDB.open(databaseName, version);`

  + 参数

    + databaseName `string` 数据库的名字

      + 如果数据库不存在，open 操作会创建该数据库，然后触发 onupgradeneeded 事件，需要在该事件的处理器中创建数据库模式
      + 如果数据库已经存在，但你指定了一个更高的数据库版本，会直接触发 onupgradeneeded 事件，允许你在处理器中更新数据库模式

    + version `整数 number` 数据库的版本

      + 不能使用 浮点数。可能导致事务无法启动，upgradeneeded 事件也不会被触发

        ```js
        // 不要这么做，因为版本会被取整为 2
        indexedDB.open("MyTestDatabase", 2.4);
        ```

      + 如果省略，打开已有数据库时，默认为当前版本
      + 新建数据库时，默认为1

  + 返回值 返回一个 IDBRequest 对象

## IDBRequest 事件

+ upgradeneeded 事件（最先触发）

  + 触发时机：数据库初始化的时候 或者 版本升级的时候（指定的版本号，大于数据库的实际版本号）
  + 如果 onupgradeneeded 事件成功执行完成，打开数据库请求的 onsuccess 处理器会被触发

  ```js
  var db;

  // 通过事件对象的target.result属性，拿到数据库实例
  request.onupgradeneeded = function (event) {
    console.log('数据库初始化的时候 或者 版本升级的时候');
    db = event.target.result;
  }
  ```

+ success 事件： 表示成功打开数据库

  ```js
  var db;

  request.onsuccess = function (event) {
    // 使用 event.target.result 来做点什么！

    // 通过request对象的result属性拿到数据库对象
    db = request.result;
    console.log('数据库打开成功');
  };
  ```

+ error 事件：表示打开数据库失败

  ```js
  request.onerror = function (event) {
    // 使用 event.target.errorCode 来做点什么！
    console.log('数据库打开报错');
  };
  ```
