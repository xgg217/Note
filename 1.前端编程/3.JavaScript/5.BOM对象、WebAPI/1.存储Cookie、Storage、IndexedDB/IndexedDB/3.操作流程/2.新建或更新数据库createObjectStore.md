# 新建数据库

## 概述

+ 新建数据库与打开数据库是同一个操作
+ 如果指定的数据库不存在，就会新建
+ 不同之处在于，后续的操作主要在upgradeneeded事件的监听函数里面完成，因为这时版本从无到有，所以会触发这个事件

+ 通常，新建数据库以后，第一件事是新建对象仓库（即新建表）

  ```js
  request.onupgradeneeded = function(event) {
    db = event.target.result;

    // 新增一张叫做person的表格，主键是id
    var objectStore = db.createObjectStore('person', { keyPath: 'id' });
  }
  ```

+ 更好的写法是先判断一下，这张表格是否存在，如果不存在再新建

  ```js
  request.onupgradeneeded = function (event) {
    db = event.target.result;
    var objectStore;
    if (!db.objectStoreNames.contains('person')) {
      objectStore = db.createObjectStore('person', { keyPath: 'id' });
    }
  }
  ```

## 主键

+ 主键（key）是默认建立索引的属性
+ 比如，数据记录是 `{ id: 1, name: '张三' }` ，那么id属性可以作为主键
+ 主键也可以指定为下一层对象的属性，比如 `{ foo: { bar: 'baz' } }` 的 `foo.bar` 也可以指定为主键

+ 如果数据记录里面没有合适作为主键的属性，那么可以让 IndexedDB 自动生成主键

  ```js
  // 主键为一个递增的整数
  var objectStore = db.createObjectStore('person',{ autoIncrement: true });
  ```

## 新建索引

+ 新建对象仓库以后，下一步可以新建索引

  ```js
  request.onupgradeneeded = function(event) {
    db = event.target.result;
    var objectStore = db.createObjectStore('person', { keyPath: 'id' });
    objectStore.createIndex('name', 'name', { unique: false });
    objectStore.createIndex('email', 'email', { unique: true });
  }
  ```
