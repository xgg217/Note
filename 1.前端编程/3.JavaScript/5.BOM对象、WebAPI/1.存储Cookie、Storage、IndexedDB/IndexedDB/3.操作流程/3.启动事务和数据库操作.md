# 启动事务和数据库操作

## 概述

+ 操作

  ```js
  let db;
  const request = window.indexedDB.open("MyTestDatabase");

  request.onupgradeneeded = function (event) {
    console.log('数据库初始化的时候 或者 版本升级的时候');
    const db = event.target.result;

    // 新增一张叫做person的表格，主键是id
    const objectStore = db.createObjectStore('person');

    objectStore.add({ name: "测试", age: 18 }, '用户1')
  }

  request.onsuccess = (event) => {
    console.log('打开成功');

    console.log(event.target.result);

    const db = event.target.result;

    const transaction = db.transaction(['person'], 'readwrite');

    const store1 = transaction.objectStore('person');

    // 增加数据
    // store1.add({ name: "测试2", age: 28 }, '用户2')
    // store1.add({ name: "测试3", age: 38 }, '用户3')

    // 删除数据
    // store1.delete('用户2')

    // 修改 数据
    // store1.put({ name: "马保国", age: 60 }, '用户3')

    const r = store1.getAll();
    console.log(r);

    r.onsuccess = (e) => {
      console.log(e.target.result);
    }
  };

  request.onerror = (event) => {
    console.error("为什么不允许我的 web 应用使用 IndexedDB！", event);
  };
  ```
