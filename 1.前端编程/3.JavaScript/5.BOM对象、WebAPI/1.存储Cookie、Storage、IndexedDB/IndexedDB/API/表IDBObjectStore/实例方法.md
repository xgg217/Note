# 实例方法

## 概述

+ 操作数据

  ```js
  request.onsuccess = (event) => {
    console.log('打开成功');

    const db = event.target.result;

    // 打开表（当前可以 读 + 写）
    const transaction = db.transaction(['person'], 'readwrite');

    // 获取表
    const store1 = transaction.objectStore('person');

    // 增加数据
    // store1.add({ name: "测试2", age: 28 }, '用户2')
    // store1.add({ name: "测试3", age: 38 }, '用户3')

    // 删除数据
    store1.delete('用户2')


  };
  ```

## add() 新增

+ API

  ```js
  add(value)
  add(value, key)
  ```

+ 参数

  + value 需要存储的值
  + key 键字用于识别记录。如果未指明，即为空

+ 返回值 一个 IDBRequest 对象，在该操作对象中触发与此相关的后续事件

  ```js
  objectStore.add({ name: "测试", age: 18 }, '用户1')
  ```

  ```js
  function add() {
    const request = db.transaction(['person'], 'readwrite')
      .objectStore('person')
      .add({ id: 1, name: 'zlm', age: 24, email: '2396307772@qq.com'});

    request.onsuccess = function (event) {
      console.log('写入数据成功', event)
    };
    request.onerror = function (event) {
      console.log('写入数据失败',event)
    }
  }

  ```


## clear()


## count()


## createIndex() 添加索引

+ 添加索引

  ```js
  objectStore.createIndex('name', 'name', {unique: false})
  ```

## delete() 删除

+ 删除

  ```js
  function remove() {
    const request = db.transaction(['person'])
      .objectStore('person')
      .delete(1);

    // 删除数据成功的回调函数
    request.onsuccess = function (event) {
      console.log('删除数据成功', event)
    }
  }
  ```


## deleteIndex()


## get() 获取数据

+ 获取数据

  ```js
  function read() {
    const transaction = db.transaction['person'];
    const objectStore = transaction.objectStore('person')
    const request = objectStore.get(1);

    request.onerror = function (event) {
      console.log('读取事务失败',event)
    }

    request.onsuccess = function (event) {
      if (request.result) {
        console.log('Name', + request.result.name)
        console.log('Age', + request.result.age)
        console.log('Email', + request.result.email)
      } else {
        console.log('未获取数据记录')
      }
      console.log('读取成功事件', event)
    }
  }
  ```


## getAll()


## getAllKeys()


## getKey()


## index()


## openCursor() 打开游标

+ 打开游标

  ```js
  // 创建一个事务
  var transaction = db.transaction(['users'], 'readonly');

  // 获取对象存储空间
  var store = transaction.objectStore('users');

  // 打开游标
  var cursorRequest = store.openCursor();

  // 游标遍历数据的回调函数
  cursorRequest.onsuccess = function(event) {
    var cursor = event.target.result;

    if (cursor) {
      var user = cursor.value;
      console.log('User:', user);

      // 继续游标
      cursor.continue();
    }
  };

   // 提交事务
  transaction.oncomplete = function(event) {
    db.close();
  };
  ```

## openKeyCursor()


## put()

+ 更新现有记录，若记录不存在则插入

  ```js
  objectStore.put({ id: 1, name: 'John Updated' });
  ```

  ```js
  function update() {
    const request = db.transaction(['person'], 'readwrite')
      .objectStore('person')
      .put({ id: 1, name: '张四', age: 32, email: '239630772@qq.com'});

    request.onsuccess = function (event) {
      console.log('更新数据成功', event)
    }

    request.onerror = function (event) {
      console.log('没有获取到更多的数据', event)
    }
  }
  ```
