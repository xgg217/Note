# 实例方法

## close() 关闭数据库连接

+ 关闭数据库连接，实际会等所有事务完成后再关闭

  ```js
  let db;

  const request = indexedDB.open(dbName, version);

  // 数据库版本变化的回调函数
  request.onversionchange = function(event) {
    db = event.target.result;
  };

  // 关闭数据库
  db.close();
  ```

## createObjectStore() 创建存储库

+ 创建存放数据的对象仓库，类似于传统关系型数据库的表格，返回一个 IDBObjectStore 对象
+ 该方法只能在version change事件监听函数中调用

+ 语法

  ```js
  createObjectStore(name)
  createObjectStore(name, options)
  ```

  + 参数

    + name 被创建的 object store 的名称。请注意创建空名称的 object store 是被允许的

    + options 可选的对象，它的属性是此方法的可选参数，其中包括以下的属性

      + keyPath 储存数据的标识符

      + autoIncrement 是否自增

        + 默认为 `false`
        + 若为 `true` 则会自动在储存的对象上添加标识符属性，并附上一个自增的正数值（1，2，3，4…）


  + 返回值 IDBObjectStore

    + 新创建的 object store 对象

  ```js
  var request = window.indexedDB.open('demo', 2);

  request.onupgradeneeded = function (event) {
    var db = event.target.result;

    db.onerror = function(event) {
      console.log('error');
    };

    const objectStore = db.createObjectStore('items', {keyPath: "id"});

    // ...
  };
  ```

## deleteObjectStore()  删除对象存储空间

+ 删除指定的对象仓库
+ 该方法只能在 `versionchange`  (版本变更模式) 事件监听函数中调用

  ```js
  // 删除对象存储空间
  db.deleteObjectStore('users');
  ```

## transaction() 开启事务

+ API https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/transaction

  ```js
  transaction(storeNames)
  transaction(storeNames, mode)
  transaction(storeNames, mode, options)
  ```

+ 参数

  + storeNames

    + 访问表的名称

    ```js
    db.transaction(["my-store-name"]);
    db.transaction("my-store-name");
    ```

  + mode 访问类型

    + `readonly` 默认 只读

    + `readwrite` 读 + 写（只在需要写入数据库时使用，版本升级的时候使用）

  + options 配置

    + `strict`

      + 只有在验证所有未完成的更改已成功写入持久存储介质后，用户代理才可能认为事务已成功提交
      + 当数据丢失的风险超过其对性能和功耗的影响时（与放松时相比），建议这样做

    + `relaxed`

      + 一旦所有未完成的更改写入操作系统，用户代理就可以认为事务已成功提交，而无需后续验证
      + 这提供了比strict更好的性能，并且推荐用于临时数据，如缓存或快速更改的记录

    + `default` 默认值

      + 用户代理应该对存储桶使用默认的持久性行为
      + 如果没有另外指定，这是事务的默认值

+ 返回值 `IDBTransaction` 事务对象


  ```js
  request.onsuccess = (event) => {

    const db = event.target.result;

    const transaction = db.transaction();
  };
  ```

+ 如果需要访问数据库中的所有对象存储，可以使用该属性

  ```js
  const transaction = db.transaction(db.objectStoreNames);
  ```
