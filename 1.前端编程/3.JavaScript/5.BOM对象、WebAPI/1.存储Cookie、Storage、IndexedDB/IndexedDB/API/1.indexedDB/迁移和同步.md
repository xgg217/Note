# 迁移和同步

## 概述

+ IndexedDB可以用于数据库迁移和数据同步的场景
+ 通过使用版本管理和升级机制，可以在数据库结构发生变化时进行迁移操作

+ 在数据库升级的回调函数中，可以执行一些迁移操作，如创建新的对象存储空间、删除旧的对象存储空间、迁移数据等

  ```js
  // 数据库升级的回调函数
  request.onupgradeneeded = function(event) {
    var db = event.target.result;

    // 创建新的对象存储空间
    var newStore = db.createObjectStore('newStore', { keyPath: 'id' });

    // 删除旧的对象存储空间
    db.deleteObjectStore('oldStore');

    // 迁移数据
    var oldStore = event.target.transaction.objectStore('oldStore');
    var newStore = event.target.transaction.objectStore('newStore');
    oldStore.openCursor().onsuccess = function(event) {
      var cursor = event.target.result;
      if (cursor) {
        var data = cursor.value;
        newStore.add(data);
        cursor.continue();
      }
    };
  };
  ```

+ 通过数据库迁移和同步机制，可以保证数据库结构的一致性，并将数据从旧的结构迁移到新的结构
