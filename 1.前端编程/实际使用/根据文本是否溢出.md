# 根据文本是否溢出

## 第三方库

+  pintura 或者 string-similarity 等

  ```js
  import { Pintura } from 'pintura';

  const canvas = document.createElement('canvas');
  const pinturaCanvas = new Pintura.Canvas(canvas);
  const textMetrics = pinturaCanvas.getTextMetrics('Hello World', {
    font: '20px Arial'
  });

  console.log(textMetrics.width); // 输出文本宽度
  ```

## 单行文本-方式1

+ js根据文本是否溢出--判断是否显示el-tooltip或title

  ```html
  <template>
    <div @mouseenter="handleMouseenter" @mouseleave="mouseleave">
      <el-tooltip placement="top" :disabled="disabled" :content="props.content">
        <slot></slot>
      </el-tooltip>
    </div>
  </template>

  <script setup>
  import { ref } from 'vue'

  const props = defineProps({
    content: {
      type: String,
      default: '',
    },
  })

  const disabled = ref(true)

  const handleMouseenter = e => {
    if (!props.content) {
      return
    }
    const cellChild = e.target.children[0]
    // range 表示文档的一个区域
    const range = document.createRange()
    range.setStart(cellChild, 0)
    range.setEnd(cellChild, cellChild.childNodes.length)

    const flag = getStyle(cellChild, '-webkit-line-clamp')
    if (flag == 'none') {
      // rangeWidth 表示元素内容的宽度
      const rangeWidth = range.getBoundingClientRect().width
      let padding =
        (parseInt(getStyle(cellChild, 'paddingLeft')) || 0) + (parseInt(getStyle(cellChild, 'paddingRight')) || 0)

      // cellChild.offsetWidth 表示选定区域的宽度
      if (rangeWidth > cellChild.offsetWidth - padding) {
        // 显示tooltip
        disabled.value = false
      }
    } else {
      // rangeHeight 表示元素内容的高度
      const rangeHeight = range.getBoundingClientRect().height
      let padding =
        (parseInt(getStyle(cellChild, 'paddingTop')) || 0) + (parseInt(getStyle(cellChild, 'paddingBottom')) || 0)

      // cellChild.offsetHeight 表示选定区域的高度
      if (rangeHeight > cellChild.offsetHeight - padding) {
        // 显示tooltip
        disabled.value = false
      }
    }
  }

  const mouseleave = () => {
    disabled.value = true
  }

  // 获取dom的样式
  const getStyle = (dom, attr) => {
    return getComputedStyle(dom, null)[attr]
  }
  </script>
  ```

+ 使用

  ```html
  <CustomTooltip :content="formData[item.key] || ''">
    <p class="text">{{ formData[item.key] || '- -' }}</p>
  </CustomTooltip>
  ```

## 单行文本 - 方式2

+ canvas 文本API `measureText` 测量文本宽度

+ 一个字一个字的测量

  ```js
  // 获取canvas元素并设置上下文
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');

  // 设置字体样式
  context.font = '16px Arial';

  // 计算文本宽度
  const text = '动态文本宽度的计算';
  const textWidth = context.measureText(text).width;

  console.log(`文本“${text}”的宽度为：${textWidth}px`);
  ```

## 多行文本溢出的位置

+ 多行文本溢出的位置:

  ```js
  // options:包含字体大小、字体类型、行高等可能影响溢出位置的信息
  function exceedIndex(str, options) {
    const div = document.createElement('div');
    div.style.width = options.width + 'px';
    div.style.height = options.height + 'px';
    div.style.fontSize = options.fontSize + 'px';
    // ...

    div.style.overflow = "hidden";
    div.style.position = "fixed";
    div.style.outline = "1px solid";
    div.style.visibility = "visible";
    div.textContent = str;
    document.body.appendChild(div);

    div.scrollWidth // 滚动宽度
    div.scrollHeight // 滚动高度

    div.remove();

  }

  const a = "abcdefg";
  // 一个字一个字的添加，然后计算
  exceedIndex("a", {width: 90});
  ```

