# 加载方式

## 方式1 .load() 同步加载

+ `.load ( url : String, onLoad : Function, onProgress : Function, onError : Function ) : undefined`

  + `url` — 包含有.gltf/.glb文件路径/URL的字符串
  + `onLoad` — 加载成功完成后将会被调用的函数。该函数接收parse所返回的已加载的JSON响应
  + `onProgress` — （可选）加载正在进行过程中会被调用的函数

    + 其参数将会是XMLHttpRequest实例，包含有总字节数 `.total` 与已加载的字节数 `.loaded`

  + `onError` — （可选）若在加载过程发生错误，将被调用的函数。该函数接收error来作为参数

+ 开始从url加载，并使用解析过的响应内容调用回调函数

  ```js
  const loader = new GLTFLoader();

  loader.load( 'gltf模型.gltf', function ( gltf ) {
    console.log('控制台查看加载gltf文件返回的对象结构',gltf);
    console.log('gltf对象场景属性',gltf.scene);
    // 返回的场景对象gltf.scene插入到threejs场景中
    group.add( gltf.scene );
  })
  ```

  ```js
  // 设置cube纹理加载器
  const cubeTextureLoader = new THREE.CubeTextureLoader();
  const envMapTexture = cubeTextureLoader.load([
    "textures/environmentMaps/1/px.jpg",
    "textures/environmentMaps/1/nx.jpg",
    "textures/environmentMaps/1/py.jpg",
    "textures/environmentMaps/1/ny.jpg",
    "textures/environmentMaps/1/pz.jpg",
    "textures/environmentMaps/1/nz.jpg",
  ]);

  // 给场景添加背景
  scene.background = envMapTexture;
  ```

## 方式2 异步加载 .loadAsync()

+ `.loadAsync ( url : String, onProgress : Function ) : Promise`

  + `url` — 一个字符串，包含要加载的文件的路径/URL
  + `onProgress` — （可选）加载过程中将会被调用的函数。参数将是一个XMLHttpRequest实例，其包含了 `.total` （总）字节数和 `.loaded` （已加载）字节数

+ 该函数等效于 `.load`，但返回的是一个 `Promise`

+ `onLoad` 由 `Promise.resolve` 处理，而 `onError` 则由 `Promise.reject` 处理

  ```js
  const loader = new GLTFLoader();

  try {
    gltf = await loader.loadAsync("人.glb");
  } catch (error) {
    console.error(error);
  }
  ```

## 方式3 .setPath() 设置文件夹

+ 文件夹

  ```js
  const textureCube = new THREE.CubeTextureLoader()
    .setPath('./环境贴图/')
    .load(['px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg']);
  textureCube.encoding = THREE.sRGBEncoding;
  loader.load("../工厂.glb", function (gltf) {
    gltf.scene.traverse(function (obj) {
      if (obj.isMesh) { //判断是否是网格模型
        obj.material.envMap = textureCube; //设置环境贴图
        obj.material.envMapIntensity = 1.0;
      }
    });
  })
  ```
